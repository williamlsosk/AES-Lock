<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">

<meta name="theme-color" content="#2563eb">
<meta name="background-color" content="#020617">

<link rel="icon" sizes="192x192" href="icon-192.png">
<link rel="icon" sizes="512x512" href="icon-512.png">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lock AES</title>
<style>
  :root{
    --bg1:#0f172a;
    --bg2:#020617;
    --stroke:#1e293b;
    --muted:#94a3b8;
    --text:#e5e7eb;
    --blue:#2563eb;
    --tg:#2AABEE;
    --ok:#22c55e;
    --err:#ef4444;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, var(--bg1), var(--bg2));
    color:var(--text);
    min-height:100vh;
  }
  .app{max-width:420px;margin:0 auto;padding:20px}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:1px solid rgba(30,41,59,.9);
    border-radius:22px;
    padding:18px;
    box-shadow: 0 18px 40px rgba(0,0,0,.45);
  }
  h1{margin:0 0 14px;text-align:center;font-weight:800;letter-spacing:.2px}

  .tabs{display:flex;gap:10px;margin:10px 0 12px}
  .tabs button{
    flex:1;padding:12px;border-radius:14px;border:none;background:#1e293b;
    color:var(--muted);font-weight:800;cursor:pointer;transition: transform .08s ease, background .15s ease;
  }
  .tabs button:active{transform:scale(.99)}
  .tabs button.active{background:var(--blue);color:#fff}

  textarea,input{
    width:100%;background: rgba(2,6,23,.75);color:#fff;
    border:1px solid var(--stroke);border-radius:14px;padding:14px;margin-bottom:12px;font-size:15px;outline:none;
  }
  textarea{min-height:120px;resize:vertical}
  input::placeholder, textarea::placeholder{color:#64748b}

  .main{
    width:100%;padding:14px;border-radius:16px;border:none;background:var(--blue);
    color:#fff;font-weight:900;font-size:16px;cursor:pointer;transition: transform .08s ease, filter .15s ease;
  }
  .main:active{transform:scale(.99)}
  .main:hover{filter:brightness(1.05)}

  .output{
    border:1px dashed rgba(37,99,235,.9);border-radius:14px;padding:12px;margin-top:10px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    word-break: break-all;background: rgba(2,6,23,.55);min-height:44px;
  }
  .status{margin-top:10px;font-weight:800;font-size:14px}
  .status.ok{color:var(--ok)}
  .status.err{color:var(--err)}

  .row{display:flex;gap:10px;margin-top:10px}
  .ghost{
    flex:1;padding:12px;border-radius:14px;border:1px solid rgba(148,163,184,.25);
    background: rgba(148,163,184,.08);color:#cbd5e1;font-weight:800;cursor:pointer;
  }
  .ghost:active{transform:scale(.99)}
  .small{margin:10px 0 0;color:var(--muted);font-size:12.5px;line-height:1.35}

  /* ========= Telegram FAB ========= */
  .tg-fab{
    position:fixed;right:22px;bottom:22px;width:58px;height:58px;border-radius:50%;
    background:var(--tg);border:none;display:flex;align-items:center;justify-content:center;padding:0;
    box-shadow:0 10px 25px rgba(0,0,0,.45);cursor:pointer;z-index:9999;
  }
  /* Fix: evitar que el SVG se ‚Äúcorte‚Äù en algunos WebView */
  .tg-fab svg{
    width:30px;height:30px;display:block;overflow:visible;fill:#fff;
  }

  .tg-panel{
    position:fixed;right:18px;bottom:92px;width:min(340px, calc(100vw - 36px));
    background: rgba(2,6,23,.92);
    border:1px solid rgba(30,41,59,.9);
    border-radius:18px;
    padding:14px;
    box-shadow:0 18px 50px rgba(0,0,0,.65);
    display:none;
    z-index:9998;
    backdrop-filter: blur(10px);
  }
  .tg-panel.open{display:block}
  .tg-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .tg-head h3{margin:0;font-size:16px;letter-spacing:.2px}
  .tg-close{
    border:none;background:transparent;color:#cbd5e1;font-size:22px;line-height:1;
    cursor:pointer;padding:6px 8px;border-radius:10px;
  }
  .tg-close:hover{background: rgba(148,163,184,.12)}
  .tg-item{
    background: rgba(15,23,42,.75);
    border: 1px solid rgba(148,163,184,.12);
    border-radius:14px;
    padding:12px;margin-bottom:10px;
    display:flex;align-items:center;justify-content:space-between;
    cursor:pointer;transition: background .15s ease, transform .08s ease;
  }
  .tg-item:active{transform:scale(.995)}
  .tg-item:hover{background: rgba(30,41,59,.6)}
  .tg-left{display:flex;flex-direction:column;gap:2px}
  .tg-left span{font-size:14px;font-weight:850}
  .tg-left small{color:var(--muted)}
  .tg-arrow{opacity:.9;font-size:18px;margin-left:12px}
</style>
</head>
<body>

<div class="app">
  <div class="card">
    <h1>üîê Lock AES</h1>

    <div class="tabs">
      <button id="tEnc" class="active" type="button">Encrypt</button>
      <button id="tDec" type="button">Decrypt</button>
    </div>

    <div id="encView">
      <textarea id="encText" placeholder="Texto"></textarea>
      <input id="encPass" type="password" placeholder="Clave" />
      <button id="encBtn" class="main" type="button">Encrypt</button>
      <div class="output" id="encOut"></div>
      <div class="status" id="encStatus"></div>

      <div class="row">
        <button class="ghost" id="copyEnc" type="button">Copiar</button>
        <button class="ghost" id="clearEnc" type="button">Limpiar</button>
      </div>

      <p class="small">
        Formato: <b>LOCK1.i=‚Ä¶ .salt .iv .ct</b> (AES‚ÄëGCM). Todo se cifra localmente.
      </p>
    </div>

    <div id="decView" style="display:none;">
      <textarea id="decPack" placeholder="Paquete cifrado (LOCK1....)"></textarea>
      <input id="decPass" type="password" placeholder="Clave" />
      <button id="decBtn" class="main" type="button">Decrypt</button>
      <div class="output" id="decOut"></div>
      <div class="status" id="decStatus"></div>

      <div class="row">
        <button class="ghost" id="copyDec" type="button">Copiar</button>
        <button class="ghost" id="clearDec" type="button">Limpiar</button>
      </div>

      <p class="small">Si la clave o el paquete no coinciden, no se podr√° descifrar.</p>
    </div>
  </div>
</div>

<!-- BOT√ìN TELEGRAM -->
<button class="tg-fab" id="tgFab" type="button" aria-label="Telegram" title="Telegram">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path d="M9.04 15.47 8.7 20.1c.49 0 .7-.21.96-.46l2.3-2.2
      4.77 3.49c.88.49 1.5.23 1.73-.81l3.14-14.72v-.01c.3-1.38-.5-1.92-1.36-1.6L2.4 9.14c-1.35.53-1.33 1.29-.23 1.63l4.42 1.38L17.1 6.5c.49-.33.94-.15.57.18L9.2 13.27c-.3.24-.29.56-.06.7l6.88 5.18" />
  </svg>
</button>

<!-- PANEL TELEGRAM -->
<div class="tg-panel" id="tgPanel" aria-hidden="true">
  <div class="tg-head">
    <h3>Telegram</h3>
    <button class="tg-close" id="tgClose" type="button" aria-label="Cerrar">√ó</button>
  </div>

  <div class="tg-item" data-tg="https://t.me/forzagrupo">
    <div class="tg-left"><span>Forza</span><small>@forzagrupo</small></div><div class="tg-arrow">‚Üó</div>
  </div>
  <div class="tg-item" data-tg="https://t.me/confiesatehoy1">
    <div class="tg-left"><span>Confiesate</span><small>@confiesatehoy1</small></div><div class="tg-arrow">‚Üó</div>
  </div>
  <div class="tg-item" data-tg="https://t.me/+ypuHtkyJG7tmZWQx">
    <div class="tg-left"><span>APK N3XU5</span><small>Invite link</small></div><div class="tg-arrow">‚Üó</div>
  </div>
  <div class="tg-item" data-tg="https://t.me/+SprIq73R1J1kZDJh">
    <div class="tg-left"><span>ALL FOR ONE</span><small>Invite link</small></div><div class="tg-arrow">‚Üó</div>
  </div>
  <div class="tg-item" data-tg="https://t.me/binneerz2">
    <div class="tg-left"><span>Binneerz</span><small>@binneerz2</small></div><div class="tg-arrow">‚Üó</div>
  </div>
  <div class="tg-item" data-tg="https://t.me/+0qw3nXYO7NA3NGNh">
    <div class="tg-left"><span>TIO-P3L1CULAS</span><small>Invite link</small></div><div class="tg-arrow">‚Üó</div>
  </div>

  <p class="small" style="margin:6px 2px 0;">
    Tip: si tienes Telegram instalado, normalmente se abre directo. Si no, se abre en el navegador.
  </p>
</div>

<script>
/* ===== Base64 URL-safe helpers ===== */
function b64u(bytes){
  let bin="";
  for(const b of bytes) bin += String.fromCharCode(b);
  return btoa(bin).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
}
function u8(b64url){
  const b64=b64url.replace(/-/g,"+").replace(/_/g,"/");
  const pad="=".repeat((4-(b64.length%4))%4);
  const bin=atob(b64+pad);
  const out=new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++) out[i]=bin.charCodeAt(i);
  return out;
}
const td=new TextDecoder();
const te=new TextEncoder();

const VERSION="LOCK1";
const PBKDF2_ITERS=200000;
const KEY_BITS=256;

async function keyFromPass(pass, saltU8){
  const baseKey = await crypto.subtle.importKey(
    "raw", te.encode(pass), {name:"PBKDF2"}, false, ["deriveKey"]
  );
  return crypto.subtle.deriveKey(
    {name:"PBKDF2", salt:saltU8, iterations:PBKDF2_ITERS, hash:"SHA-256"},
    baseKey,
    {name:"AES-GCM", length:KEY_BITS},
    false,
    ["encrypt","decrypt"]
  );
}
function randBytes(n){const a=new Uint8Array(n);crypto.getRandomValues(a);return a;}

async function encryptText(plain, pass){
  const salt=randBytes(16);
  const iv=randBytes(12);
  const key=await keyFromPass(pass, salt);
  const ctBuf=await crypto.subtle.encrypt({name:"AES-GCM", iv}, key, te.encode(plain));
  const ct=new Uint8Array(ctBuf);
  return `${VERSION}.i=${PBKDF2_ITERS}.${b64u(salt)}.${b64u(iv)}.${b64u(ct)}`;
}
async function decryptPack(pack, pass){
  const parts=pack.trim().split(".");
  if(parts.length<5) throw new Error("Paquete incompleto");
  const [v,iPart,saltB64,ivB64,ctB64]=parts;
  if(v!==VERSION) throw new Error("Versi√≥n inv√°lida");
  if(!iPart.startsWith("i=")) throw new Error("i inv√°lido");
  const salt=u8(saltB64);
  const iv=u8(ivB64);
  const ct=u8(ctB64);
  const key=await keyFromPass(pass, salt);
  const ptBuf=await crypto.subtle.decrypt({name:"AES-GCM", iv}, key, ct);
  return td.decode(ptBuf);
}

/* ===== Tabs ===== */
const tEnc=document.getElementById("tEnc");
const tDec=document.getElementById("tDec");
const encView=document.getElementById("encView");
const decView=document.getElementById("decView");
function setTab(which){
  const enc=(which==="enc");
  tEnc.classList.toggle("active", enc);
  tDec.classList.toggle("active", !enc);
  encView.style.display=enc ? "block" : "none";
  decView.style.display=enc ? "none" : "block";
}
tEnc.addEventListener("click", ()=>setTab("enc"));
tDec.addEventListener("click", ()=>setTab("dec"));

/* ===== Encrypt UI ===== */
const encText=document.getElementById("encText");
const encPass=document.getElementById("encPass");
const encOut=document.getElementById("encOut");
const encStatus=document.getElementById("encStatus");

document.getElementById("encBtn").addEventListener("click", async ()=>{
  encStatus.textContent=""; encStatus.className="status"; encOut.textContent="";
  const txt=encText.value??""; const pass=encPass.value??"";
  if(!txt.trim()){encStatus.textContent="Escribe un texto";encStatus.className="status err";return;}
  if(!pass){encStatus.textContent="Escribe una clave";encStatus.className="status err";return;}
  try{
    encOut.textContent = await encryptText(txt, pass);
    encStatus.textContent="OK"; encStatus.className="status ok";
  }catch{
    encStatus.textContent="Error"; encStatus.className="status err";
  }
});

document.getElementById("copyEnc").addEventListener("click", async ()=>{
  const v=encOut.textContent.trim(); if(!v) return;
  try{ await navigator.clipboard.writeText(v); encStatus.textContent="Copiado"; encStatus.className="status ok"; }catch{}
});
document.getElementById("clearEnc").addEventListener("click", ()=>{
  encText.value=""; encPass.value=""; encOut.textContent=""; encStatus.textContent=""; encStatus.className="status";
});

/* ===== Decrypt UI ===== */
const decPack=document.getElementById("decPack");
const decPass=document.getElementById("decPass");
const decOut=document.getElementById("decOut");
const decStatus=document.getElementById("decStatus");

document.getElementById("decBtn").addEventListener("click", async ()=>{
  decStatus.textContent=""; decStatus.className="status"; decOut.textContent="";
  const pack=decPack.value??""; const pass=decPass.value??"";
  if(!pack.trim()){decStatus.textContent="Pega el paquete cifrado";decStatus.className="status err";return;}
  if(!pass){decStatus.textContent="Escribe la clave";decStatus.className="status err";return;}
  try{
    decOut.textContent = await decryptPack(pack, pass);
    decStatus.textContent="OK"; decStatus.className="status ok";
  }catch{
    decStatus.textContent="Clave o paquete inv√°lido"; decStatus.className="status err";
  }
});

document.getElementById("copyDec").addEventListener("click", async ()=>{
  const v=decOut.textContent.trim(); if(!v) return;
  try{ await navigator.clipboard.writeText(v); decStatus.textContent="Copiado"; decStatus.className="status ok"; }catch{}
});
document.getElementById("clearDec").addEventListener("click", ()=>{
  decPack.value=""; decPass.value=""; decOut.textContent=""; decStatus.textContent=""; decStatus.className="status";
});

/* ===== Telegram panel + fallback anti ERR_UNKNOWN_URL_SCHEME ===== */
const tgPanel=document.getElementById("tgPanel");
const tgFab=document.getElementById("tgFab");
const tgClose=document.getElementById("tgClose");

function toggleTG(force){
  const open=(typeof force==="boolean") ? force : !tgPanel.classList.contains("open");
  tgPanel.classList.toggle("open", open);
  tgPanel.setAttribute("aria-hidden", open ? "false" : "true");
}
tgFab.addEventListener("click", ()=>toggleTG());
tgClose.addEventListener("click", ()=>toggleTG(false));

function buildDeepLink(urlHttps){
  try{
    const u=new URL(urlHttps);
    const p=(u.pathname||"/").replace(/^\/+/, "");
    if(!p) return null;
    if(p.startsWith("+")){
      const invite=p.slice(1);
      return `tg://join?invite=${encodeURIComponent(invite)}`;
    }
    const username=p.split("/")[0];
    return `tg://resolve?domain=${encodeURIComponent(username)}`;
  }catch{ return null; }
}

function tryOpenAppScheme(schemeUrl){
  const iframe=document.createElement("iframe");
  iframe.style.display="none";
  iframe.src=schemeUrl;
  document.body.appendChild(iframe);
  setTimeout(()=>{ try{ document.body.removeChild(iframe); }catch{} }, 1200);
}

/*
  openTG(urlHttps):
  1) Intenta abrir Telegram (deep link) sin romper WebView (iframe oculto)
  2) Fallback SIEMPRE a https://t.me/... para evitar la pantalla:
     net::ERR_UNKNOWN_URL_SCHEME
*/
function openTG(urlHttps){
  const deep=buildDeepLink(urlHttps);
  if(deep){ try{ tryOpenAppScheme(deep); }catch{} }
  setTimeout(()=>{ window.location.href=urlHttps; }, 450);
}

document.querySelectorAll(".tg-item").forEach(el=>{
  el.addEventListener("click", ()=>{
    const url=el.getAttribute("data-tg");
    if(url) openTG(url);
  });
});

document.addEventListener("click", (e)=>{
  if(!tgPanel.classList.contains("open")) return;
  if(tgPanel.contains(e.target) || tgFab.contains(e.target)) return;
  toggleTG(false);
});
</script>
/* === Registro del Service Worker (PWA) === */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker
      .register("./pwabuilder-sw.js")
      .then(reg => {
        console.log("Service Worker registrado:", reg.scope);
      })
      .catch(err => {
        console.error("Error registrando Service Worker:", err);
      });
  });
}
</script>
</body>
</html>
